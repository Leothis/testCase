# Test Case

## About

This is a test case that aims read and write weather information, that
uses **[JWT (JSON Web Token)](https://jwt.io)**
with **[Spring Security](https://spring.io/projects/spring-security)** and
**[Spring Boot](https://spring.io/projects/spring-boot)**.

## Requirements

This api is build with with Maven 3.6.x and Java 11.

## Usage

The api runs at [http://localhost:8080](http://localhost:8080). Just start the api with the Spring
Boot maven plugin (`mvn spring-boot:run`).

**H2-Console** can be used for viewing the database
under [http://localhost:8080/h2-console](http://localhost:8080/h2-console):

The datasource url, username and password can be found in (`application.properties`).

The database is saved in the home directory under the name (`testcase`), it can be deleted manually
to reset the database, after rerunning the api it forms again in an empty state, so while running
the database in the empty state make sure to call `/initialize-database(GET)` in order for the api
to work intendedly.

## Api Details

There are admin and end-user accounts, an admin and a user account must be inserted into the
database by calling (`/initialize-database(GET)`) after running the api.

Once the users and authorities are initialized, the database can populated by
calling (`/populate (GET)`) the default entry count for database population is 1 million entries.

The initialized user username and password combinations are below, which can be used as the body of
the  (`/login (POST)`) endpoint, which returns a JWT token for further operations that must be added
into the headers of following requests in the form of "Bearer" + "&nbsp; " + JWTtoken."

(`Bearer eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJhZG1pbiIsImF1dGgiOiJST0xFX0FETUlOLFJPTEVfVVNFUiIsImV4cCI6MTYzMzM4NDk2Mn0.GUpxBaNfAWeOA8XmQirR8-oXACwysQ0eQZYXzyLAViUJ3_k-hMScPRUIwh7AAHRdECGnN1EkdDnn7z0KMRXj7g`)

(`Combinations:`)
Admin - admin:admin  
User - user:password

The available endpoints are as follows:

```
● Initialize database users and authorities at /initialize-database (GET).
● Populate database with random generated weather information at /populate (GET).
● User credential (username and password) submission endpoint that is exposed at /login (POST).
● User create endpoint is exposed at /user (POST).
● User information endpoint is exposed at /user/{user_id} (GET).
● Updating user information endpoint is exposed at /user/{user_id} (PUT).
● Deleting the user endpoint is exposed at /user/{user_id} (DELETE).
● Weather information endpoint is exposed at /weather (GET) and can be filtered by given parameters (condition, time range, location, temperature).
● Weather information creation endpoint is exposed at /weather-add (POST).
```

There are two csv files to populate the database from, (`generated_weather_data.csv`)
and (`generated_weather_data_10mil.csv`) under resources. The first one has 1 million random
generated weather information entries and the other one has 10 million entries, by default the csv
that has 1 million entries is used under the /populate endpoint.

Make sure to call the /populate(GET) endpoint after the api runs in order to write the weather
information to the database.

/populate(GET) endpoint and /login enpoint do not require a JWT token to be triggered, however every
other enpoint will need a valid JWT token in the header in order to be authorized.

Aside from the /user/{user_id} (GET) endpoint and /weather (GET) endpoint, every endpoint that
requires a JWT token is only accesible by users that have admin authority.

End users are only authorized to call /user/{user_id} (GET) endpoint and /weather (GET) endpoint.

##Generating password hashes for new users
Bcrypt is used to encode passwords. New passwords can be generated by using this website [https://bcrypt-generator.com/](https://bcrypt-generator.com/)

## Docker

You can run the application by creating a docker image and running the application inside of a
container by executing the following commands from the project directory:

```
//Build 
docker build . -t testcase-app  

//run
docker run -d -p 8080:8080 -p testcase-app   
```

